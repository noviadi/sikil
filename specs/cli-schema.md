# CLI Schema Spec

## One-Sentence Description

CLI schema defines command-line arguments and subcommands.

## Overview

The CLI schema is defined in `src/cli/app.rs` using clap derive macros. It provides the `Cli` struct for global options and the `Commands` enum for subcommands.

## Cli Struct

Top-level parser with global flags:

```rust
#[derive(Parser)]
#[command(name = "sikil")]
#[command(version = "0.1.0")]
#[command(about = "Manage AI coding assistant skills across multiple agents")]
#[command(after_help = "EXAMPLES:\n    sikil list\n    ...")]
pub struct Cli {
    #[arg(long, global = true)]
    pub json: bool,

    #[arg(short, long, global = true)]
    pub verbose: bool,

    #[arg(short, long, global = true)]
    pub quiet: bool,

    #[arg(long, global = true)]
    pub no_cache: bool,

    #[command(subcommand)]
    pub command: Commands,
}
```

## Global Options

| Flag | Short | Description |
|------|-------|-------------|
| `--json` | - | Output in JSON format |
| `--verbose` | `-v` | Enable verbose output |
| `--quiet` | `-q` | Suppress all output (except JSON data) |
| `--no-cache` | - | Disable cache for this command |

Mutual exclusivity: `--quiet` and `--verbose` cannot be used together (enforced in `main.rs`).

## Commands Enum

| Command | Description | Key Arguments |
|---------|-------------|---------------|
| `list` | List installed skills | `--agent`, `--managed`, `--unmanaged`, `--conflicts`, `--duplicates` |
| `show` | Show skill details | `<name>` |
| `install` | Install from path or Git URL | `<source>`, `--to` |
| `validate` | Validate SKILL.md | `<path>` |
| `adopt` | Adopt unmanaged skill | `<name>`, `--from` |
| `unmanage` | Convert to unmanaged | `<name>`, `--agent`, `--yes` |
| `remove` | Remove installed skill | `<name>`, `--agent`, `--all`, `--yes` |
| `sync` | Sync skill to agents | `<name>`, `--all`, `--to` |
| `config` | Manage configuration | `--edit`, `--set` |
| `completions` | Generate shell completions | `<shell>`, `--output` |

Each command includes `after_help` examples in the source.

## Built-in Flags

- `--version` - Display version (from `#[command(version)]`)
- `--help` / `-h` - Display help (auto-generated by clap)

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| 2 | Validation error |
| 3 | Skill not found |
| 4 | Permission error |
| 5 | Network error |

All errors exit with appropriate code and message to stderr.

## Error Display

Pattern in `main.rs`:

```rust
if let Err(e) = execute_command(args, &config) {
    eprintln!("Error: {}", e);
    std::process::exit(1);
}
```

## Acceptance Criteria

- `sikil --version` prints version string and exits with code 0
- `sikil --help` prints usage information and exits with code 0
- `sikil -v -q` exits with non-zero code due to mutual exclusivity
- `--json` flag is available on all subcommands (global option)
- Unknown subcommand prints error to stderr and exits with non-zero code
- Missing required argument prints error with usage hint to stderr
- Validation error exits with code 2
- Skill not found error exits with code 3
- Permission error exits with code 4
- Network error exits with code 5
- All error messages are written to stderr

## Dependencies

- `clap` - argument parsing with derive macros

## Used By

- `main.rs` - parses `Cli::parse()` and dispatches to command handlers
